<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-i18n="user_dashboard_title">User Dashboard - Task Planning & Management System</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Chart.js from cdnjs -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.min.js"></script>
    <link rel="stylesheet" th:href="@{/css/style.css}">
    <style>
        /* Calendar custom styles */
        .fc { font-family: inherit; }
        .fc .fc-toolbar-title { color: var(--text); font-size: 1.5rem; }
        .fc .fc-button { background-color: var(--primary); border-color: var(--primary); }
        .fc .fc-button:hover { background-color: var(--primary-dark); }
        .fc .fc-daygrid-day { background-color: var(--card-bg); }
        .fc .fc-daygrid-day:hover { background-color: rgba(67, 97, 238, 0.1); }
        .fc .fc-daygrid-day-number { color: var(--text); }
        .fc .fc-col-header-cell-cushion { color: var(--text); }
        .fc .fc-event { cursor: pointer; border-radius: 4px; padding: 2px 4px; font-size: 0.85rem; }
        .fc .fc-day-today { background-color: rgba(67, 97, 238, 0.05) !important; }
        .fc-theme-standard td, .fc-theme-standard th { border-color: rgba(0, 0, 0, 0.1); }
        [data-theme="dark"] .fc-theme-standard td, [data-theme="dark"] .fc-theme-standard th { border-color: rgba(255, 255, 255, 0.1); }
        .form-row { display: flex; gap: 16px; }
        .form-row .form-group { flex: 1; }
    </style>
</head>
<body data-theme="dark">
<!-- Store user data for JavaScript -->
<script th:inline="javascript">
    window.currentUser = {
        id: [[${currentUser.id}]],
        username: [[${currentUser.username}]],
        email: [[${currentUser.email}]],
        firstName: [[${currentUser.firstName}]],
        lastName: [[${currentUser.lastName}]],
        role: [[${currentUser.role}]],
        fullName: [[${userName}]],
        initials: [[${userInitials}]]
    };
    window.dashboardStats = {
        activeTasks: [[${activeTasks}]],
        completedTasks: [[${completedTasks}]],
        overdueTasks: [[${overdueTasks}]],
        taskCompletionRate: [[${taskCompletionRate}]]
    };
</script>

<!-- Sidebar -->
<div class="sidebar">
    <div class="logo" th:text="${userInitials}">U</div>

    <!-- Main Navigation -->
    <a href="#" class="nav-item active" data-page="dashboard">
        <i class="fas fa-th-large"></i>
        <span data-i18n="nav_dashboard">Dashboard</span>
    </a>

    <a href="#" class="nav-item" data-page="tasks">
        <i class="fas fa-tasks"></i>
        <span data-i18n="my_tasks">My Tasks</span>
    </a>

    <a href="#" class="nav-item" data-page="calendar">
        <i class="fas fa-calendar-alt"></i>
        <span data-i18n="nav_calendar">Calendar</span>
    </a>

    <a href="#" class="nav-item" data-page="messages">
        <i class="fas fa-comments"></i>
        <span data-i18n="nav_messages">Messages</span>
    </a>

    <div class="nav-divider"></div>

    <a href="#" class="nav-item" data-page="deliverables">
        <i class="fas fa-file-upload"></i>
        <span data-i18n="my_deliverables">My Deliverables</span>
    </a>

    <a href="#" class="nav-item" data-page="time-tracking">
        <i class="fas fa-clock"></i>
        <span data-i18n="time_tracking">Time Tracking</span>
    </a>

    <div class="nav-divider"></div>

    <a href="#" class="nav-item" data-page="profile">
        <i class="fas fa-user"></i>
        <span data-i18n="profile">Profile</span>
    </a>

    <a href="#" class="nav-item" data-page="settings">
        <i class="fas fa-cog"></i>
        <span data-i18n="nav_settings">Settings</span>
    </a>

    <a href="#" id="logout-link" class="nav-item" style="margin-top: auto;">
        <i class="fas fa-sign-out-alt"></i>
        <span data-i18n="nav_logout">Logout</span>
    </a>
</div>

<!-- Main Content -->
<div class="main-content">
    <!-- Top Bar -->
    <div class="top-bar">
        <div class="quick-search">
            <div class="search-bar">
                <i class="fas fa-search"></i>
                <input type="text" placeholder="Search tasks, projects..." id="quick-search-input" autocomplete="off" data-i18n-placeholder="search_tasks">
            </div>
            <div class="quick-search-results" id="quick-search-results" style="display: none;"></div>
        </div>
        <div class="admin-info">
            <div class="notification-icons">
                <div class="notification-wrapper">
                    <button class="notification-btn" onclick="toggleNotificationDropdown()">
                        <i class="fas fa-bell"></i>
                        <span class="notification-badge" id="notification-count" style="display: none;">0</span>
                    </button>
                    <div class="notification-dropdown" id="notification-dropdown" style="display: none;">
                        <div class="notification-empty">
                            <i class="fas fa-bell-slash"></i>
                            <p>No new notifications</p>
                        </div>
                    </div>
                </div>
                <div class="message-wrapper">
                    <button class="notification-btn" onclick="navigateTo('messages')">
                        <i class="fas fa-envelope"></i>
                        <span class="message-badge" id="unread-message-count" style="display: none;">0</span>
                    </button>
                </div>
                <button class="notification-btn" onclick="navigateTo('settings')">
                    <i class="fas fa-cog"></i>
                </button>
                <button class="theme-toggle" id="theme-toggle">
                    <i class="fas fa-moon"></i>
                </button>
            </div>
            <div class="admin-profile">
                <div class="avatar" style="width: 40px; height: 40px; background: var(--primary); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: 600; font-size: 14px;">
                    <span th:text="${userInitials}">U</span>
                </div>
                <div class="admin-details">
                    <span class="username" th:text="${userName}">User</span>
                    <span class="role" th:text="${userRole}">Employee</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Content Wrapper -->
    <div class="content-wrapper">
        <!-- Dashboard Page -->
        <div class="page-content active" id="dashboard">
            <div class="section-header">
                <h2 class="section-title" data-i18n="task_overview">Task Overview</h2>
            </div>

            <!-- Key Metrics -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-info">
                        <h3 th:text="${activeTasks}">0</h3>
                        <p data-i18n="active_tasks">Active Tasks</p>
                    </div>
                    <div class="stat-icon" style="background-color: rgba(67, 97, 238, 0.1); color: var(--primary);">
                        <i class="fas fa-tasks"></i>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-info">
                        <h3 th:text="${overdueTasks}">0</h3>
                        <p data-i18n="overdue_tasks">Overdue Tasks</p>
                    </div>
                    <div class="stat-icon" style="background-color: rgba(230, 57, 70, 0.1); color: var(--danger);">
                        <i class="fas fa-exclamation-triangle"></i>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-info">
                        <h3 th:text="${completedTasks}">0</h3>
                        <p data-i18n="completed_tasks">Completed Tasks</p>
                    </div>
                    <div class="stat-icon" style="background-color: rgba(42, 157, 143, 0.1); color: var(--success);">
                        <i class="fas fa-check-circle"></i>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-info">
                        <h3><span th:text="${taskCompletionRate}">0</span>%</h3>
                        <p data-i18n="completion_rate">Completion Rate</p>
                    </div>
                    <div class="stat-icon" style="background-color: rgba(86, 207, 225, 0.1); color: var(--info);">
                        <i class="fas fa-chart-pie"></i>
                    </div>
                </div>
            </div>

            <!-- Charts Row -->
            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 24px; margin-bottom: 24px;">
                <div class="chart-container" style="background: var(--card-bg); border-radius: 12px; padding: 24px; box-shadow: var(--shadow);">
                    <h3 class="chart-title" style="margin-bottom: 20px;" data-i18n="task_status">Task Status</h3>
                    <div style="height: 250px; position: relative;">
                        <canvas id="userTaskStatusChart"></canvas>
                    </div>
                </div>
                <div class="chart-container" style="background: var(--card-bg); border-radius: 12px; padding: 24px; box-shadow: var(--shadow);">
                    <h3 class="chart-title" style="margin-bottom: 20px;" data-i18n="weekly_progress">Weekly Progress</h3>
                    <div style="height: 250px; position: relative;">
                        <canvas id="userWeeklyProgressChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Upcoming Tasks -->
            <div class="table-container">
                <div class="table-header">
                    <h3 class="table-title" data-i18n="upcoming_tasks">Upcoming Tasks</h3>
                    <a href="#" onclick="navigateToPage('tasks')" style="color: var(--primary);" data-i18n="view_all">View All</a>
                </div>
                <table class="data-table" id="user-upcoming-tasks-table">
                    <thead>
                    <tr>
                        <th data-i18n="task_name">Task Name</th>
                        <th data-i18n="project">Project</th>
                        <th data-i18n="priority">Priority</th>
                        <th data-i18n="deadline">Deadline</th>
                        <th data-i18n="status">Status</th>
                    </tr>
                    </thead>
                    <tbody id="user-upcoming-tasks-body">
                    <tr>
                        <td colspan="5" style="text-align: center;">
                            <i class="fas fa-spinner fa-spin"></i> Loading...
                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- My Tasks Page -->
        <div class="page-content" id="tasks">
            <div class="section-header">
                <h2 class="section-title" data-i18n="my_tasks">My Tasks</h2>
            </div>

            <div class="table-container">
                <div class="table-header">
                    <h3 class="table-title" data-i18n="all_tasks">All Tasks</h3>
                    <div style="display: flex; gap: 10px;">
                        <select id="filter-task-status" style="background-color: var(--bg); color: var(--text); border: 1px solid rgba(0,0,0,0.1); padding: 8px; border-radius: 6px;">
                            <option value="" data-i18n="all_status">All Status</option>
                            <option value="TODO">To Do</option>
                            <option value="IN_PROGRESS">In Progress</option>
                            <option value="COMPLETED">Completed</option>
                        </select>
                        <select id="filter-task-priority" style="background-color: var(--bg); color: var(--text); border: 1px solid rgba(0,0,0,0.1); padding: 8px; border-radius: 6px;">
                            <option value="" data-i18n="all_priorities">All Priorities</option>
                            <option value="CRITICAL">Critical</option>
                            <option value="HIGH">High</option>
                            <option value="MEDIUM">Medium</option>
                            <option value="LOW">Low</option>
                        </select>
                    </div>
                </div>

                <table class="data-table" id="tasks-table">
                    <thead>
                    <tr>
                        <th data-i18n="task_name">Task Name</th>
                        <th data-i18n="project">Project</th>
                        <th data-i18n="priority">Priority</th>
                        <th data-i18n="deadline">Deadline</th>
                        <th data-i18n="progress">Progress</th>
                        <th data-i18n="status">Status</th>
                        <th data-i18n="actions">Actions</th>
                    </tr>
                    </thead>
                    <tbody id="tasks-table-body">
                    <tr>
                        <td colspan="7" style="text-align: center;">
                            <i class="fas fa-spinner fa-spin"></i> Loading tasks...
                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Calendar Page -->
        <div class="page-content" id="calendar">
            <div class="section-header">
                <h2 class="section-title" data-i18n="my_calendar">My Calendar</h2>
                <button class="btn btn-primary" onclick="openModal('create-event-modal')">
                    <i class="fas fa-plus"></i> <span data-i18n="add_event">Add Event</span>
                </button>
            </div>

            <div style="display: grid; grid-template-columns: 1fr 300px; gap: 24px;">
                <div class="calendar-container" style="background: var(--card-bg); border-radius: 12px; padding: 24px; box-shadow: var(--shadow);">
                    <div id="user-calendar"></div>
                </div>

                <div class="upcoming-events" style="background: var(--card-bg); border-radius: 12px; padding: 24px; box-shadow: var(--shadow);">
                    <h3 style="margin-bottom: 20px;" data-i18n="upcoming_deadlines">Upcoming Deadlines</h3>
                    <div id="user-upcoming-events">
                        <div style="text-align: center; color: var(--text-secondary); padding: 20px;">
                            <i class="fas fa-calendar-day" style="font-size: 2rem; margin-bottom: 10px;"></i>
                            <p data-i18n="no_upcoming_events">No upcoming events</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Messages Page -->
        <div class="page-content" id="messages">
            <div class="section-header">
                <h2 class="section-title" data-i18n="nav_messages">Messages</h2>
                <button class="btn btn-primary" onclick="openModal('compose-message-modal')">
                    <i class="fas fa-pen"></i> <span data-i18n="compose_message">Compose Message</span>
                </button>
            </div>

            <div style="display: grid; grid-template-columns: 300px 1fr; gap: 24px; height: calc(100vh - 200px);">
                <!-- Conversation List -->
                <div class="message-sidebar" style="background: var(--card-bg); border-radius: 12px; padding: 16px; box-shadow: var(--shadow); overflow-y: auto;">
                    <div style="margin-bottom: 16px;">
                        <input type="text" id="message-search" placeholder="Search messages..." style="width: 100%;" oninput="searchMessages(this.value)">
                    </div>
                    <h4 style="margin-bottom: 12px; color: var(--text-secondary);" data-i18n="my_conversations">My Conversations</h4>
                    <div id="user-conversations-list" class="conversation-list">
                        <div class="loading-placeholder" style="text-align: center; padding: 20px;">
                            <i class="fas fa-spinner fa-spin"></i> Loading...
                        </div>
                    </div>
                </div>

                <!-- Message Thread -->
                <div class="message-area" style="display: flex; flex-direction: column; background: var(--card-bg); border-radius: 12px; box-shadow: var(--shadow); overflow: hidden;">
                    <!-- Message Header -->
                    <div id="message-header" style="padding: 16px; border-bottom: 1px solid var(--border-color); display: none;">
                        <div style="display: flex; align-items: center; gap: 12px;">
                            <div id="message-header-avatar" style="width: 40px; height: 40px; background: var(--primary); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: 600;">
                                P
                            </div>
                            <div>
                                <h4 id="message-header-title" style="margin: 0;">Select a conversation</h4>
                                <p id="message-header-subtitle" style="color: var(--text-secondary); font-size: 0.85rem; margin: 0;"></p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Messages Container -->
                    <div id="messages-container" style="flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 16px;">
                        <div id="no-conversation-selected" style="display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100%; color: var(--text-secondary);">
                            <i class="fas fa-comments" style="font-size: 4rem; margin-bottom: 20px; opacity: 0.3;"></i>
                            <h3 data-i18n="no_conversation_selected">No conversation selected</h3>
                            <p data-i18n="choose_conversation_user">Choose a conversation to start messaging</p>
                        </div>
                        <div id="messages-list" style="display: none; flex-direction: column; gap: 16px;">
                            <!-- Messages will be loaded here -->
                        </div>
                    </div>

                    <!-- Message Input -->
                    <div id="message-input-area" style="padding: 16px; border-top: 1px solid var(--border-color); display: none;">
                        <form id="send-message-form" style="display: flex; gap: 12px;">
                            <input type="hidden" id="message-recipient-id">
                            <input type="hidden" id="message-project-id">
                            <div style="flex: 1; display: flex; gap: 8px;">
                                <button type="button" class="btn btn-secondary" style="padding: 10px;" onclick="attachFile()">
                                    <i class="fas fa-paperclip"></i>
                                </button>
                                <input type="text" id="message-input" placeholder="Type your message..." style="flex: 1;">
                            </div>
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-paper-plane"></i> <span data-i18n="send">Send</span>
                            </button>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <!-- My Deliverables Page -->
        <div class="page-content" id="deliverables">
            <div class="section-header">
                <h2 class="section-title" data-i18n="my_deliverables">My Deliverables</h2>
                <button class="btn btn-primary" onclick="openModal('submit-deliverable-modal')">
                    <i class="fas fa-upload"></i> <span data-i18n="submit_deliverable">Submit Deliverable</span>
                </button>
            </div>

            <div class="table-container">
                <div class="table-header">
                    <h3 class="table-title" data-i18n="submitted_deliverables">Submitted Deliverables</h3>
                    <div style="display: flex; gap: 10px;">
                        <select id="filter-deliverable-status" style="background-color: var(--bg); color: var(--text); border: 1px solid rgba(0,0,0,0.1); padding: 8px; border-radius: 6px;">
                            <option value="" data-i18n="all_status">All Status</option>
                            <option value="PENDING">Pending</option>
                            <option value="APPROVED">Approved</option>
                            <option value="REJECTED">Rejected</option>
                        </select>
                    </div>
                </div>

                <table class="data-table" id="user-deliverables-table">
                    <thead>
                    <tr>
                        <th data-i18n="task">Task</th>
                        <th data-i18n="file">File</th>
                        <th data-i18n="status">Status</th>
                        <th data-i18n="submitted_at">Submitted At</th>
                        <th data-i18n="feedback">Feedback</th>
                    </tr>
                    </thead>
                    <tbody id="user-deliverables-body">
                    <tr>
                        <td colspan="5" style="text-align: center;">
                            <i class="fas fa-spinner fa-spin"></i> Loading deliverables...
                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Time Tracking Page -->
        <div class="page-content" id="time-tracking">
            <div class="section-header">
                <h2 class="section-title" data-i18n="time_tracking">Time Tracking</h2>
                <button class="btn btn-primary" onclick="openModal('log-time-modal')">
                    <i class="fas fa-clock"></i> <span data-i18n="log_time">Log Time</span>
                </button>
            </div>

            <!-- Time Summary Cards -->
            <div class="stats-grid" style="margin-bottom: 24px;">
                <div class="stat-card">
                    <div class="stat-info">
                        <h3 id="today-hours">0h</h3>
                        <p data-i18n="today">Today</p>
                    </div>
                    <div class="stat-icon" style="background-color: rgba(67, 97, 238, 0.1); color: var(--primary);">
                        <i class="fas fa-calendar-day"></i>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-info">
                        <h3 id="week-hours">0h</h3>
                        <p data-i18n="this_week">This Week</p>
                    </div>
                    <div class="stat-icon" style="background-color: rgba(42, 157, 143, 0.1); color: var(--success);">
                        <i class="fas fa-calendar-week"></i>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-info">
                        <h3 id="month-hours">0h</h3>
                        <p data-i18n="this_month">This Month</p>
                    </div>
                    <div class="stat-icon" style="background-color: rgba(244, 162, 97, 0.1); color: var(--warning);">
                        <i class="fas fa-calendar-alt"></i>
                    </div>
                </div>
            </div>

            <div class="table-container">
                <div class="table-header">
                    <h3 class="table-title" data-i18n="time_logs">Time Logs</h3>
                </div>
                <table class="data-table" id="time-logs-table">
                    <thead>
                    <tr>
                        <th data-i18n="task">Task</th>
                        <th data-i18n="hours">Hours</th>
                        <th data-i18n="date">Date</th>
                        <th data-i18n="description">Description</th>
                    </tr>
                    </thead>
                    <tbody id="time-logs-body">
                    <tr>
                        <td colspan="4" style="text-align: center;">
                            <i class="fas fa-spinner fa-spin"></i> Loading time logs...
                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Profile Page -->
        <div class="page-content" id="profile">
            <div class="section-header">
                <h2 class="section-title" data-i18n="profile">Profile</h2>
                <button class="btn btn-primary" onclick="openModal('edit-profile-modal')">
                    <i class="fas fa-edit"></i> <span data-i18n="edit_profile">Edit Profile</span>
                </button>
            </div>

            <div style="display: grid; grid-template-columns: 300px 1fr; gap: 24px;">
                <!-- Profile Card -->
                <div style="background: var(--card-bg); border-radius: 12px; padding: 24px; text-align: center; box-shadow: var(--shadow);">
                    <div class="avatar" style="width: 120px; height: 120px; background: var(--primary); border-radius: 50%; margin: 0 auto 20px auto; display: flex; align-items: center; justify-content: center; color: white; font-weight: 600; font-size: 40px; border: 4px solid var(--primary-dark, var(--primary));">
                        <span th:text="${userInitials}">U</span>
                    </div>
                    <h3 style="margin-bottom: 8px;" th:text="${userName}">User Name</h3>
                    <p style="color: var(--text-secondary); margin-bottom: 16px;" th:text="${userRole}">Role</p>
                    <div style="display: flex; justify-content: center; gap: 10px;">
                        <button class="btn btn-secondary" style="padding: 8px 16px;" onclick="openModal('change-password-modal')">
                            <i class="fas fa-key"></i> <span data-i18n="change_password">Change Password</span>
                        </button>
                    </div>
                </div>

                <!-- Profile Details -->
                <div style="background: var(--card-bg); border-radius: 12px; padding: 24px; box-shadow: var(--shadow);">
                    <h3 style="margin-bottom: 20px;" data-i18n="profile_information">Profile Information</h3>
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px;">
                        <div>
                            <label style="color: var(--text-secondary); font-size: 0.9rem;" data-i18n="first_name">First Name</label>
                            <p style="font-weight: 500; margin-top: 4px;" th:text="${currentUser.firstName}">-</p>
                        </div>
                        <div>
                            <label style="color: var(--text-secondary); font-size: 0.9rem;" data-i18n="last_name">Last Name</label>
                            <p style="font-weight: 500; margin-top: 4px;" th:text="${currentUser.lastName}">-</p>
                        </div>
                        <div>
                            <label style="color: var(--text-secondary); font-size: 0.9rem;" data-i18n="email">Email</label>
                            <p style="font-weight: 500; margin-top: 4px;" th:text="${currentUser.email}">-</p>
                        </div>
                        <div>
                            <label style="color: var(--text-secondary); font-size: 0.9rem;" data-i18n="username">Username</label>
                            <p style="font-weight: 500; margin-top: 4px;" th:text="${currentUser.username}">-</p>
                        </div>
                        <div>
                            <label style="color: var(--text-secondary); font-size: 0.9rem;" data-i18n="role">Role</label>
                            <p style="font-weight: 500; margin-top: 4px;" th:text="${userRole}">-</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Settings Page -->
        <div class="page-content" id="settings">
            <div class="section-header">
                <h2 class="section-title" data-i18n="settings">Settings</h2>
                <button class="btn btn-primary" onclick="saveAllSettings()">
                    <i class="fas fa-save"></i> <span data-i18n="save_changes">Save Changes</span>
                </button>
            </div>

            <!-- General Settings -->
            <div class="settings-section" style="background: var(--card-bg); border-radius: 12px; padding: 24px; margin-bottom: 24px; box-shadow: var(--shadow);">
                <h3 style="margin-bottom: 20px; display: flex; align-items: center; gap: 10px;">
                    <i class="fas fa-cog" style="color: var(--primary);"></i> <span data-i18n="general_settings">General Settings</span>
                </h3>
                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px;">
                    <div class="form-group">
                        <label data-i18n="language">Language</label>
                        <select id="setting-language" style="width: 100%;" onchange="changeLanguage(this.value)">
                            <option value="en">English</option>
                            <option value="fr">Français</option>
                            <option value="es">Español</option>
                            <option value="de">Deutsch</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label data-i18n="timezone">Timezone</label>
                        <select id="setting-timezone" style="width: 100%;">
                            <option value="UTC">UTC</option>
                            <option value="Europe/Paris" selected>Europe/Paris (CET)</option>
                            <option value="America/New_York">America/New York (EST)</option>
                            <option value="Asia/Tokyo">Asia/Tokyo (JST)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label data-i18n="date_format">Date Format</label>
                        <select id="setting-date-format" style="width: 100%;">
                            <option value="DD/MM/YYYY" selected>DD/MM/YYYY</option>
                            <option value="MM/DD/YYYY">MM/DD/YYYY</option>
                            <option value="YYYY-MM-DD">YYYY-MM-DD</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label data-i18n="time_format">Time Format</label>
                        <select id="setting-time-format" style="width: 100%;">
                            <option value="24h" selected>24 Hour</option>
                            <option value="12h">12 Hour (AM/PM)</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- Notification Settings -->
            <div class="settings-section" style="background: var(--card-bg); border-radius: 12px; padding: 24px; margin-bottom: 24px; box-shadow: var(--shadow);">
                <h3 style="margin-bottom: 20px; display: flex; align-items: center; gap: 10px;">
                    <i class="fas fa-bell" style="color: var(--warning);"></i> <span data-i18n="notification_settings">Notification Settings</span>
                </h3>
                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px;">
                    <div class="setting-toggle" style="display: flex; align-items: center; justify-content: space-between; padding: 16px; background: var(--bg); border-radius: 8px;">
                        <div>
                            <strong data-i18n="email_notifications">Email Notifications</strong>
                            <p style="color: var(--text-secondary); font-size: 0.9rem; margin-top: 4px;" data-i18n="email_notif_desc">Receive task updates via email</p>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="setting-email-notif" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    <div class="setting-toggle" style="display: flex; align-items: center; justify-content: space-between; padding: 16px; background: var(--bg); border-radius: 8px;">
                        <div>
                            <strong data-i18n="task_reminders">Task Reminders</strong>
                            <p style="color: var(--text-secondary); font-size: 0.9rem; margin-top: 4px;" data-i18n="task_reminder_desc">Get reminders for upcoming deadlines</p>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="setting-task-reminder" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    <div class="setting-toggle" style="display: flex; align-items: center; justify-content: space-between; padding: 16px; background: var(--bg); border-radius: 8px;">
                        <div>
                            <strong data-i18n="message_alerts">Message Alerts</strong>
                            <p style="color: var(--text-secondary); font-size: 0.9rem; margin-top: 4px;" data-i18n="message_alerts_desc">Alert for new messages</p>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="setting-message-alerts" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    <div class="setting-toggle" style="display: flex; align-items: center; justify-content: space-between; padding: 16px; background: var(--bg); border-radius: 8px;">
                        <div>
                            <strong data-i18n="deliverable_feedback">Deliverable Feedback</strong>
                            <p style="color: var(--text-secondary); font-size: 0.9rem; margin-top: 4px;" data-i18n="deliverable_feedback_desc">Notifications when deliverables are reviewed</p>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="setting-deliverable-feedback" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                </div>
            </div>

            <!-- Appearance Settings -->
            <div class="settings-section" style="background: var(--card-bg); border-radius: 12px; padding: 24px; box-shadow: var(--shadow);">
                <h3 style="margin-bottom: 20px; display: flex; align-items: center; gap: 10px;">
                    <i class="fas fa-palette" style="color: var(--primary);"></i> <span data-i18n="appearance_settings">Appearance Settings</span>
                </h3>
                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px;">
                    <div class="theme-option" onclick="setTheme('light')" style="padding: 20px; background: #f8f9fa; border-radius: 12px; cursor: pointer; text-align: center; border: 2px solid transparent;" id="theme-light">
                        <i class="fas fa-sun" style="font-size: 2rem; color: #f59e0b; margin-bottom: 10px;"></i>
                        <p style="font-weight: 500; color: #1f2937;" data-i18n="light_mode">Light Mode</p>
                    </div>
                    <div class="theme-option" onclick="setTheme('dark')" style="padding: 20px; background: #1f2937; border-radius: 12px; cursor: pointer; text-align: center; border: 2px solid var(--primary);" id="theme-dark">
                        <i class="fas fa-moon" style="font-size: 2rem; color: #8b5cf6; margin-bottom: 10px;"></i>
                        <p style="font-weight: 500; color: #f8f9fa;" data-i18n="dark_mode">Dark Mode</p>
                    </div>
                    <div class="theme-option" onclick="setTheme('auto')" style="padding: 20px; background: linear-gradient(135deg, #f8f9fa 50%, #1f2937 50%); border-radius: 12px; cursor: pointer; text-align: center; border: 2px solid transparent;" id="theme-auto">
                        <i class="fas fa-adjust" style="font-size: 2rem; color: var(--primary); margin-bottom: 10px;"></i>
                        <p style="font-weight: 500;" data-i18n="auto_mode">Auto (System)</p>
                    </div>
                </div>
                <div style="margin-top: 20px;">
                    <div class="form-group">
                        <label data-i18n="primary_color">Primary Color</label>
                        <div style="display: flex; gap: 10px; margin-top: 10px;">
                            <div onclick="setPrimaryColor('#4361ee')" style="width: 40px; height: 40px; background: #4361ee; border-radius: 8px; cursor: pointer; border: 3px solid var(--primary);"></div>
                            <div onclick="setPrimaryColor('#7c3aed')" style="width: 40px; height: 40px; background: #7c3aed; border-radius: 8px; cursor: pointer;"></div>
                            <div onclick="setPrimaryColor('#2563eb')" style="width: 40px; height: 40px; background: #2563eb; border-radius: 8px; cursor: pointer;"></div>
                            <div onclick="setPrimaryColor('#059669')" style="width: 40px; height: 40px; background: #059669; border-radius: 8px; cursor: pointer;"></div>
                            <div onclick="setPrimaryColor('#dc2626')" style="width: 40px; height: 40px; background: #dc2626; border-radius: 8px; cursor: pointer;"></div>
                            <div onclick="setPrimaryColor('#d97706')" style="width: 40px; height: 40px; background: #d97706; border-radius: 8px; cursor: pointer;"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Edit Task Modal -->
<div class="modal" id="edit-task-modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3 class="modal-title" data-i18n="update_progress">Update Task Progress</h3>
            <button class="close-btn" onclick="closeModal('edit-task-modal')">×</button>
        </div>
        <form id="edit-task-form">
            <div class="modal-body">
                <input type="hidden" id="edit-task-id" name="id">
                <div class="form-group">
                    <label for="edit-task-name" data-i18n="task_name">Task Name</label>
                    <input type="text" id="edit-task-name" name="name" readonly>
                </div>
                <div class="form-group">
                    <label for="edit-task-progress" data-i18n="progress">Progress (%)</label>
                    <input type="range" id="edit-task-progress" name="progress" min="0" max="100" step="5" oninput="document.getElementById('progress-value').textContent = this.value + '%'">
                    <span id="progress-value" style="display: block; text-align: center; margin-top: 10px; font-weight: 500;">0%</span>
                </div>
                <div class="form-group">
                    <label for="edit-task-status" data-i18n="status">Status</label>
                    <select id="edit-task-status" name="status">
                        <option value="TODO">To Do</option>
                        <option value="IN_PROGRESS">In Progress</option>
                        <option value="COMPLETED">Completed</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="closeModal('edit-task-modal')" data-i18n="cancel">Cancel</button>
                <button type="submit" class="btn btn-primary" data-i18n="save_changes">Save Changes</button>
            </div>
        </form>
    </div>
</div>

<!-- Compose Message Modal -->
<div class="modal" id="compose-message-modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3 class="modal-title" data-i18n="compose_message">Compose Message</h3>
            <button class="close-btn" onclick="closeModal('compose-message-modal')">×</button>
        </div>
        <form id="compose-message-form">
            <div class="modal-body">
                <div class="form-group">
                    <label for="compose-recipient" data-i18n="send_to">Send To</label>
                    <select id="compose-recipient" name="recipientId" required>
                        <option value="">Select recipient...</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="compose-message" data-i18n="message">Message *</label>
                    <textarea id="compose-message" name="content" placeholder="Type your message here..." rows="6" required></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="closeModal('compose-message-modal')" data-i18n="cancel">Cancel</button>
                <button type="submit" class="btn btn-primary">
                    <i class="fas fa-paper-plane"></i> <span data-i18n="send_message">Send Message</span>
                </button>
            </div>
        </form>
    </div>
</div>

<!-- Create Event Modal -->
<div class="modal" id="create-event-modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3 class="modal-title" data-i18n="create_event">Create Event</h3>
            <button class="close-btn" onclick="closeModal('create-event-modal')">×</button>
        </div>
        <form id="create-event-form">
            <div class="modal-body">
                <div class="form-group">
                    <label for="event-title" data-i18n="event_title">Event Title *</label>
                    <input type="text" id="event-title" name="title" placeholder="Enter event title" required>
                </div>
                <div class="form-group">
                    <label for="event-description" data-i18n="description">Description</label>
                    <textarea id="event-description" name="description" placeholder="Enter event description"></textarea>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="event-start" data-i18n="start_date">Start Date & Time *</label>
                        <input type="datetime-local" id="event-start" name="startTime" required>
                    </div>
                    <div class="form-group">
                        <label for="event-end" data-i18n="end_date">End Date & Time *</label>
                        <input type="datetime-local" id="event-end" name="endTime" required>
                    </div>
                </div>
                <div class="form-group">
                    <label for="event-color" data-i18n="color">Color</label>
                    <select id="event-color" name="color">
                        <option value="#4361ee">Blue</option>
                        <option value="#2a9d8f">Green</option>
                        <option value="#e63946">Red</option>
                        <option value="#f4a261">Orange</option>
                        <option value="#9b59b6">Purple</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="closeModal('create-event-modal')" data-i18n="cancel">Cancel</button>
                <button type="submit" class="btn btn-primary" data-i18n="create_event">Create Event</button>
            </div>
        </form>
    </div>
</div>

<!-- Submit Deliverable Modal -->
<div class="modal" id="submit-deliverable-modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3 class="modal-title" data-i18n="submit_deliverable">Submit Deliverable</h3>
            <button class="close-btn" onclick="closeModal('submit-deliverable-modal')">×</button>
        </div>
        <form id="submit-deliverable-form" enctype="multipart/form-data">
            <div class="modal-body">
                <div class="form-group">
                    <label for="deliverable-task-select" data-i18n="task">Task *</label>
                    <select id="deliverable-task-select" name="taskId" required>
                        <option value="">Select Task</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="deliverable-file" data-i18n="file">File * (Max 10MB)</label>
                    <div class="file-upload-wrapper" style="position: relative;">
                        <input type="file" id="deliverable-file" name="file" 
                               accept=".pdf,.doc,.docx,.xls,.xlsx,.ppt,.pptx,.txt,.zip,.rar,.jpg,.jpeg,.png,.gif"
                               onchange="handleFileSelect(this)" required>
                        <div id="file-info" style="margin-top: 8px; color: var(--text-secondary); font-size: 0.875rem;"></div>
                    </div>
                    <small style="color: var(--text-secondary);">Supported: PDF, DOC, DOCX, XLS, XLSX, PPT, PPTX, TXT, ZIP, RAR, Images</small>
                </div>
                <div class="form-group">
                    <label for="deliverable-comments" data-i18n="comments">Comments (Optional)</label>
                    <textarea id="deliverable-comments" name="comments" placeholder="Add any comments about this deliverable..."></textarea>
                </div>
                <div class="form-group">
                    <label for="deliverable-description" data-i18n="description">Description</label>
                    <textarea id="deliverable-description" name="description" placeholder="Add any notes about this deliverable" rows="3"></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="closeModal('submit-deliverable-modal')" data-i18n="cancel">Cancel</button>
                <button type="submit" class="btn btn-primary" data-i18n="submit">Submit Deliverable</button>
            </div>
        </form>
    </div>
</div>

<!-- Log Time Modal -->
<div class="modal" id="log-time-modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3 class="modal-title" data-i18n="log_time">Log Time</h3>
            <button class="close-btn" onclick="closeModal('log-time-modal')">×</button>
        </div>
        <form id="log-time-form">
            <div class="modal-body">
                <div class="form-group">
                    <label for="time-task" data-i18n="task">Task</label>
                    <select id="time-task" name="taskId" required>
                        <option value="">Select Task</option>
                    </select>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="time-spent" data-i18n="hours">Hours *</label>
                        <input type="number" id="time-spent" name="hours" min="0.5" step="0.5" required>
                    </div>
                    <div class="form-group">
                        <label for="time-date" data-i18n="date">Date *</label>
                        <input type="date" id="time-date" name="date" required>
                    </div>
                </div>
                <div class="form-group">
                    <label for="time-description" data-i18n="description">Description</label>
                    <textarea id="time-description" name="description" placeholder="What did you work on?"></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="closeModal('log-time-modal')" data-i18n="cancel">Cancel</button>
                <button type="submit" class="btn btn-primary" data-i18n="log_time">Log Time</button>
            </div>
        </form>
    </div>
</div>

<!-- Edit Profile Modal -->
<div class="modal" id="edit-profile-modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3 class="modal-title" data-i18n="edit_profile">Edit Profile</h3>
            <button class="close-btn" onclick="closeModal('edit-profile-modal')">×</button>
        </div>
        <form id="edit-profile-form">
            <div class="modal-body">
                <div class="form-row">
                    <div class="form-group">
                        <label for="profile-firstName" data-i18n="first_name">First Name *</label>
                        <input type="text" id="profile-firstName" name="firstName" th:value="${currentUser.firstName}" required>
                    </div>
                    <div class="form-group">
                        <label for="profile-lastName" data-i18n="last_name">Last Name *</label>
                        <input type="text" id="profile-lastName" name="lastName" th:value="${currentUser.lastName}" required>
                    </div>
                </div>
                <div class="form-group">
                    <label for="profile-email" data-i18n="email">Email *</label>
                    <input type="email" id="profile-email" name="email" th:value="${currentUser.email}" required>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="closeModal('edit-profile-modal')" data-i18n="cancel">Cancel</button>
                <button type="submit" class="btn btn-primary" data-i18n="save_changes">Save Changes</button>
            </div>
        </form>
    </div>
</div>

<!-- Change Password Modal -->
<div class="modal" id="change-password-modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3 class="modal-title" data-i18n="change_password">Change Password</h3>
            <button class="close-btn" onclick="closeModal('change-password-modal')">×</button>
        </div>
        <form id="change-password-form">
            <div class="modal-body">
                <div class="form-group">
                    <label for="current-password" data-i18n="current_password">Current Password *</label>
                    <input type="password" id="current-password" name="currentPassword" required>
                </div>
                <div class="form-group">
                    <label for="new-password" data-i18n="new_password">New Password *</label>
                    <input type="password" id="new-password" name="newPassword" required>
                </div>
                <div class="form-group">
                    <label for="confirm-password" data-i18n="confirm_password">Confirm New Password *</label>
                    <input type="password" id="confirm-password" name="confirmPassword" required>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="closeModal('change-password-modal')" data-i18n="cancel">Cancel</button>
                <button type="submit" class="btn btn-primary" data-i18n="change_password">Change Password</button>
            </div>
        </form>
    </div>
</div>

<!-- FullCalendar JS -->
<!-- FullCalendar JS (v6 has CSS bundled in JS) -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/6.1.10/index.global.min.js"></script>
<script th:src="@{/js/script.js}"></script>
<script th:src="@{/js/i18n.js}"></script>
<script th:src="@{/js/push-notifications.js}"></script>
<script th:src="@{/js/user-dashboard.js}"></script>
</body>
</html>
